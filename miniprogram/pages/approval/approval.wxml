<!-- pages/approval/approval.wxml -->
<view class="container" wx:if="{{hasApprovalPermission}}">
  <!-- æ ‡ç­¾åˆ‡æ¢ -->
  <view class="tabs">
    <view 
      class="tab-item {{currentTab === 'leave' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="leave"
    >
      <text>è¯·å‡å®¡æ‰¹</text>
      <text class="tab-badge" wx:if="{{leaveCount > 0}}">{{leaveCount}}</text>
    </view>
    <view 
      class="tab-item {{currentTab === 'overtime' ? 'active' : ''}}"
      bindtap="switchTab"
      data-tab="overtime"
    >
      <text>åŠ ç­å®¡æ‰¹</text>
      <text class="tab-badge" wx:if="{{overtimeCount > 0}}">{{overtimeCount}}</text>
    </view>
  </view>

  <!-- è¯·å‡å®¡æ‰¹åˆ—è¡¨ -->
  <view wx:if="{{currentTab === 'leave'}}">
    <block wx:if="{{leaveList && leaveList.length > 0}}">
      <view class="list-item" wx:for="{{leaveList}}" wx:key="id">
        <view class="list-item-header">
          <text class="list-item-title">{{item.startDate}} ~ {{item.endDate}}</text>
          <text class="status-badge status-pending">{{item.statusName}}</text>
        </view>
        <view class="list-item-content">
          <view style="display: flex; margin-bottom: 8px;">
            <view style="flex: 1;"><text class="label">ç”³è¯·äºº:</text> {{item.applicant_name ? item.applicant_name : 'ç”¨æˆ·' + item.user_id}}</view>
            <view style="flex: 1;"><text class="label">è¯·å‡å¤©æ•°:</text> {{item.days}}å¤©</view>
          </view>
          <view><text class="label">åŸå› :</text> {{item.reason}}</view>
        </view>
        <view class="list-item-footer">
          <button class="btn btn-primary btn-small" bindtap="viewLeaveDetail" data-id="{{item.id}}">è¯¦æƒ…</button>
          <button class="btn btn-success btn-small" bindtap="approveLeave" data-id="{{item.id}}" data-approved="{{true}}">æ‰¹å‡†</button>
          <button class="btn btn-danger btn-small" bindtap="approveLeave" data-id="{{item.id}}" data-approved="{{false}}">æ‹’ç»</button>
        </view>
      </view>
    </block>

    <view class="empty-state" wx:else>
      <view class="empty-state-icon">âœ…</view>
      <view class="empty-state-text">æš‚æ— å¾…å®¡æ‰¹è¯·å‡</view>
    </view>
  </view>

  <!-- åŠ ç­å®¡æ‰¹åˆ—è¡¨ -->
  <view wx:if="{{currentTab === 'overtime'}}">
    <block wx:if="{{overtimeList && overtimeList.length > 0}}">
      <view class="list-item" wx:for="{{overtimeList}}" wx:key="id">
        <view class="list-item-header">
          <text class="list-item-title">{{item.startTime}} ~ {{item.endTime}}</text>
          <text class="status-badge status-pending">å¾…å®¡æ‰¹</text>
        </view>
        <view class="list-item-content">
          <view style="display: flex; margin-bottom: 8px;">
            <view style="flex: 1;"><text class="label">ç”³è¯·äºº:</text> {{item.applicant_name ? item.applicant_name : 'ç”¨æˆ·' + item.user_id}}</view>
            <view style="flex: 1;"><text class="label">åŠ ç­å¤©æ•°:</text> {{item.days}}å¤©</view>
          </view>
          <view><text class="label">åŸå› :</text> {{item.reason}}</view>
        </view>
        <view class="list-item-footer">
          <button class="btn btn-primary btn-small" bindtap="viewOvertimeDetail" data-id="{{item.id}}">è¯¦æƒ…</button>
          <button class="btn btn-success btn-small" bindtap="approveOvertime" data-id="{{item.id}}" data-approved="{{true}}">æ‰¹å‡†</button>
          <button class="btn btn-danger btn-small" bindtap="approveOvertime" data-id="{{item.id}}" data-approved="{{false}}">æ‹’ç»</button>
        </view>
      </view>
    </block>

    <view class="empty-state" wx:else>
      <view class="empty-state-icon">âœ…</view>
      <view class="empty-state-text">æš‚æ— å¾…å®¡æ‰¹åŠ ç­</view>
    </view>
  </view>
</view>

<view class="container" wx:else>
  <view class="empty-state">
    <view class="empty-state-icon">ğŸš«</view>
    <view class="empty-state-text">æ‚¨æ²¡æœ‰å®¡æ‰¹æƒé™</view>
  </view>
</view>

<!-- è¯¦æƒ…å¼¹çª— -->
<view class="detail-modal-overlay" wx:if="{{showDetailModal}}" bindtap="closeDetailModal">
  <view class="detail-modal" catchtap="stopPropagation">
    <view class="detail-modal-header">
      <text class="detail-modal-title">{{detailTitle}}</text>
      <text class="detail-modal-close" bindtap="closeDetailModal">Ã—</text>
    </view>
    
    <view class="detail-modal-content">
      <!-- è¯·å‡è¯¦æƒ… -->
      <block wx:if="{{detailType === 'leave' && detailData}}">
        <view class="detail-item">
          <text class="detail-label">çŠ¶æ€:</text>
          <text class="detail-value">{{detailData.status}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç”³è¯·äºº:</text>
          <text class="detail-value">{{detailData.applicant}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å¼€å§‹æ—¥æœŸ:</text>
          <text class="detail-value">{{detailData.startDate}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç»“æŸæ—¥æœŸ:</text>
          <text class="detail-value">{{detailData.endDate}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å¤©æ•°:</text>
          <text class="detail-value">{{detailData.days}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">åŸå› :</text>
          <text class="detail-value">{{detailData.reason}}</text>
        </view>
        
        <!-- éƒ¨é—¨å®¡æ‰¹ -->
        <block wx:if="{{detailData.deptApprover}}">
          <view class="detail-section-divider"></view>
          <view class="detail-section-title">éƒ¨é—¨å®¡æ‰¹</view>
          <view class="detail-item">
            <text class="detail-label">å®¡æ‰¹äºº:</text>
            <text class="detail-value">{{detailData.deptApprover}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ—¶é—´:</text>
            <text class="detail-value">{{detailData.deptApprovedAt}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ„è§:</text>
            <text class="detail-value">{{detailData.deptComment || 'æ— '}}</text>
          </view>
        </block>
        
        <!-- å‰¯æ€»å®¡æ‰¹ -->
        <block wx:if="{{detailData.vpApprover}}">
          <view class="detail-section-divider"></view>
          <view class="detail-section-title">å‰¯æ€»å®¡æ‰¹</view>
          <view class="detail-item">
            <text class="detail-label">å®¡æ‰¹äºº:</text>
            <text class="detail-value">{{detailData.vpApprover}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ—¶é—´:</text>
            <text class="detail-value">{{detailData.vpApprovedAt}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ„è§:</text>
            <text class="detail-value">{{detailData.vpComment || 'æ— '}}</text>
          </view>
        </block>
        
        <!-- æ€»ç»ç†å®¡æ‰¹ -->
        <block wx:if="{{detailData.gmApprover}}">
          <view class="detail-section-divider"></view>
          <view class="detail-section-title">æ€»ç»ç†å®¡æ‰¹</view>
          <view class="detail-item">
            <text class="detail-label">å®¡æ‰¹äºº:</text>
            <text class="detail-value">{{detailData.gmApprover}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ—¶é—´:</text>
            <text class="detail-value">{{detailData.gmApprovedAt}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ„è§:</text>
            <text class="detail-value">{{detailData.gmComment || 'æ— '}}</text>
          </view>
        </block>
      </block>
      
      <!-- åŠ ç­è¯¦æƒ… -->
      <block wx:if="{{detailType === 'overtime' && detailData}}">
        <view class="detail-item">
          <text class="detail-label">çŠ¶æ€:</text>
          <text class="detail-value">{{detailData.status}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç”³è¯·äºº:</text>
          <text class="detail-value">{{detailData.applicant}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å¼€å§‹æ—¶é—´:</text>
          <text class="detail-value">{{detailData.startTime}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">ç»“æŸæ—¶é—´:</text>
          <text class="detail-value">{{detailData.endTime}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">å¤©æ•°:</text>
          <text class="detail-value">{{detailData.days}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">åŸå› :</text>
          <text class="detail-value">{{detailData.reason}}</text>
        </view>
        
        <!-- å®¡æ‰¹ä¿¡æ¯ -->
        <block wx:if="{{detailData.approver}}">
          <view class="detail-section-divider"></view>
          <view class="detail-section-title">å®¡æ‰¹ä¿¡æ¯</view>
          <view class="detail-item">
            <text class="detail-label">å®¡æ‰¹äºº:</text>
            <text class="detail-value">{{detailData.approver}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ—¶é—´:</text>
            <text class="detail-value">{{detailData.approvedAt}}</text>
          </view>
          <view class="detail-item">
            <text class="detail-label">æ„è§:</text>
            <text class="detail-value">{{detailData.comment || 'æ— '}}</text>
          </view>
        </block>
      </block>
    </view>
    
    <view class="detail-modal-footer">
      <button class="btn btn-primary btn-block" bindtap="closeDetailModal">å…³é—­</button>
    </view>
  </view>
</view>

