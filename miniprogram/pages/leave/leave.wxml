<!-- pages/leave/leave.wxml -->
<view class="container">
  <button class="btn btn-primary btn-block" bindtap="goToApply">ç”³è¯·è¯·å‡</button>

  <view class="leave-list" wx:if="{{leaveList && leaveList.length > 0}}">
    <view class="list-item" wx:for="{{leaveList}}" wx:key="id">
      <view class="list-item-header">
        <text class="list-item-title">{{item.timeRange}}</text>
      </view>
      <view class="list-item-status">
        <text class="label">çŠ¶æ€:</text>
        <text class="status-badge status-{{item.statusClass}}">{{item.statusName}}</text>
      </view>
      <view class="list-item-content">
        <view><text class="label">å¤©æ•°:</text> {{item.days}}å¤©</view>
        <view><text class="label">ç±»å‹:</text> {{item.leave_type_name || 'æ™®é€šè¯·å‡'}}</view>
        <view><text class="label">åŸå› :</text> {{item.reason}}</view>
        <view><text class="label">ç”³è¯·æ—¶é—´:</text> {{item.createdAt}}</view>
        <view wx:if="{{item.pendingApprover}}" style="color: #1890ff; margin-top: 5px;">
          <text class="label">{{item.pendingApprover}}</text>
        </view>
      </view>
      <view class="list-item-footer">
        <button 
          class="btn btn-secondary btn-small" 
          wx:if="{{item.canCancel}}"
          bindtap="cancelLeave"
          data-id="{{item.id}}"
        >
          æ’¤å›ç”³è¯·
        </button>
        <button 
          class="btn btn-primary btn-small" 
          wx:if="{{item.canView}}"
          bindtap="viewDetail"
          data-id="{{item.id}}"
        >
          è¯¦æƒ…
        </button>
        <button 
          class="btn btn-danger btn-small" 
          wx:if="{{item.canDelete}}"
          bindtap="deleteLeave"
          data-id="{{item.id}}"
        >
          åˆ é™¤
        </button>
      </view>
    </view>
  </view>

  <view class="empty-state" wx:else>
    <view class="empty-state-icon">ğŸ–ï¸</view>
    <view class="empty-state-text">æš‚æ— è¯·å‡è®°å½•</view>
  </view>
</view>

<!-- è¯¦æƒ…å¼¹çª— -->
<view class="detail-modal-overlay" wx:if="{{showDetailModal}}" bindtap="closeDetailModal">
  <view class="detail-modal" catchtap="stopPropagation">
    <view class="detail-modal-header">
      <text class="detail-modal-title">{{detailTitle}}</text>
      <text class="detail-modal-close" bindtap="closeDetailModal">Ã—</text>
    </view>
    
    <view class="detail-modal-content" wx:if="{{detailData}}">
      <view class="detail-item">
        <text class="detail-label">çŠ¶æ€:</text>
        <text class="status-badge status-{{detailData.statusClass}}">{{detailData.status}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">ç”³è¯·äºº:</text>
        <text class="detail-value">{{detailData.applicant}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">ç±»å‹:</text>
        <text class="detail-value">{{detailData.leaveType || 'æ™®é€šè¯·å‡'}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">è¯·å‡æ—¶é—´:</text>
        <text class="detail-value">{{detailData.timeRange}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">å¤©æ•°:</text>
        <text class="detail-value">{{detailData.days}}</text>
      </view>
      <view class="detail-item">
        <text class="detail-label">åŸå› :</text>
        <text class="detail-value">{{detailData.reason}}</text>
      </view>
      
      <!-- éƒ¨é—¨å®¡æ‰¹ -->
      <block wx:if="{{detailData.deptApprover}}">
        <view class="detail-section-divider"></view>
        <view class="detail-section-title">éƒ¨é—¨å®¡æ‰¹</view>
        <view class="detail-item">
          <text class="detail-label">å®¡æ‰¹äºº:</text>
          <text class="detail-value">{{detailData.deptApprover}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ—¶é—´:</text>
          <text class="detail-value">{{detailData.deptApprovedAt}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ„è§:</text>
          <text class="detail-value">{{detailData.deptComment || 'æ— '}}</text>
        </view>
      </block>
      
      <!-- å‰¯æ€»å®¡æ‰¹ -->
      <block wx:if="{{detailData.vpApprover}}">
        <view class="detail-section-divider"></view>
        <view class="detail-section-title">å‰¯æ€»å®¡æ‰¹</view>
        <view class="detail-item">
          <text class="detail-label">å®¡æ‰¹äºº:</text>
          <text class="detail-value">{{detailData.vpApprover}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ—¶é—´:</text>
          <text class="detail-value">{{detailData.vpApprovedAt}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ„è§:</text>
          <text class="detail-value">{{detailData.vpComment || 'æ— '}}</text>
        </view>
      </block>
      
      <!-- æ€»ç»ç†å®¡æ‰¹ -->
      <block wx:if="{{detailData.gmApprover}}">
        <view class="detail-section-divider"></view>
        <view class="detail-section-title">æ€»ç»ç†å®¡æ‰¹</view>
        <view class="detail-item">
          <text class="detail-label">å®¡æ‰¹äºº:</text>
          <text class="detail-value">{{detailData.gmApprover}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ—¶é—´:</text>
          <text class="detail-value">{{detailData.gmApprovedAt}}</text>
        </view>
        <view class="detail-item">
          <text class="detail-label">æ„è§:</text>
          <text class="detail-value">{{detailData.gmComment || 'æ— '}}</text>
        </view>
      </block>
    </view>
    
    <view class="detail-modal-footer">
      <button class="btn btn-primary btn-block" bindtap="closeDetailModal">å…³é—­</button>
    </view>
  </view>
</view>

