<!-- pages/overtime/apply/apply.wxml -->
<view class="container">
  <view class="form-group">
    <view class="form-label">加班类型 *</view>
    <picker 
      mode="selector" 
      range="{{['单日', '多日']}}"
      value="{{overtimeTypeIndex}}"
      bindchange="onTypeChange"
    >
      <view class="picker">
        <text>{{overtimeTypeText || '请选择加班类型'}}</text>
        <text class="picker-icon">▼</text>
      </view>
    </picker>
  </view>

  <!-- 单日加班 -->
  <view wx:if="{{overtimeType === 'single'}}">
    <view class="form-group">
      <view class="form-label">加班日期 *</view>
      <picker mode="date" value="{{date}}" bindchange="onDateChange">
        <view class="picker">
          <text>{{date || '请选择日期'}}</text>
          <text class="picker-icon">📅</text>
        </view>
      </picker>
    </view>

    <view class="form-group">
      <view class="form-label">开始时间节点 *</view>
      <picker 
        mode="selector" 
        range="{{startTimeNodes}}"
        range-key="label"
        value="{{startTimeNodeIndex}}"
        bindchange="onStartTimeNodeChange"
      >
        <view class="picker">
          <text>{{startTimeNodeLabel || '请选择开始时间节点'}}</text>
          <text class="picker-icon">🕐</text>
        </view>
      </picker>
    </view>

    <view class="form-group">
      <view class="form-label">结束时间节点 *</view>
      <picker 
        mode="selector" 
        range="{{endTimeNodes}}"
        range-key="label"
        value="{{endTimeNodeIndex}}"
        bindchange="onEndTimeNodeChange"
      >
        <view class="picker">
          <text>{{endTimeNodeLabel || '请选择结束时间节点'}}</text>
          <text class="picker-icon">🕐</text>
        </view>
      </picker>
    </view>

    <view class="form-group">
      <view class="form-label">计算出的加班天数</view>
      <view class="form-display">{{calculatedDays}} 天</view>
      <view class="form-hint">系统根据时间节点自动计算</view>
    </view>
  </view>

  <!-- 多日加班 -->
  <view wx:if="{{overtimeType === 'multi'}}">
    <view class="form-group">
      <view class="form-label">开始日期 *</view>
      <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
        <view class="picker">
          <text>{{startDate || '请选择开始日期'}}</text>
          <text class="picker-icon">📅</text>
        </view>
      </picker>
    </view>

    <view class="form-group">
      <view class="form-label">开始日期时间节点 *</view>
      <picker 
        mode="selector" 
        range="{{startTimeNodes}}"
        range-key="label"
        value="{{startDateTimeNodeIndex}}"
        bindchange="onStartDateTimeNodeChange"
      >
        <view class="picker">
          <text>{{startDateTimeNodeLabel || '请选择开始日期时间节点'}}</text>
          <text class="picker-icon">🕐</text>
        </view>
      </picker>
    </view>

    <view class="form-group">
      <view class="form-label">结束日期 *</view>
      <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
        <view class="picker">
          <text>{{endDate || '请选择结束日期'}}</text>
          <text class="picker-icon">📅</text>
        </view>
      </picker>
    </view>

    <view class="form-group">
      <view class="form-label">结束日期时间节点 *</view>
      <picker 
        mode="selector" 
        range="{{endTimeNodes}}"
        range-key="label"
        value="{{endDateTimeNodeIndex}}"
        bindchange="onEndDateTimeNodeChange"
      >
        <view class="picker">
          <text>{{endDateTimeNodeLabel || '请选择结束日期时间节点'}}</text>
          <text class="picker-icon">🕐</text>
        </view>
      </picker>
    </view>

    <view class="form-group">
      <view class="form-label">计算出的加班天数</view>
      <view class="form-display" wx:if="{{!useManualDays}}">{{calculatedDays}} 天</view>
      <view class="form-display" wx:else style="color: #999;">
        <text>自动计算: {{autoCalculatedDays}} 天</text>
        <text style="margin-left: 20rpx; color: #1890ff;">手动设置: {{calculatedDays}} 天</text>
      </view>
      <view class="form-hint">系统根据日期和时间节点自动计算</view>
    </view>

    <view class="form-group">
      <view class="form-label">手动调节加班天数（可选）</view>
      <view style="display: flex; align-items: center; margin: 10px 0;">
        <switch checked="{{useManualDays}}" bindchange="onUseManualDaysChange" style="margin-right: 10px;" />
        <text style="font-size: 28rpx; color: #666;">启用手动调节</text>
      </view>
          <view wx:if="{{useManualDays}}" style="margin-top: 20rpx;">
            <input 
              type="digit" 
              class="form-input" 
              value="{{manualDays}}" 
              bindinput="onManualDaysInput"
              placeholder="请输入加班天数（整数或x.5）"
            />
            <view class="form-hint">手动输入加班天数，将覆盖自动计算结果（只能输入整数天或x.5天，如：1、1.5、2、2.5）</view>
          </view>
    </view>
  </view>

  <view class="form-group">
    <view class="form-label">加班原因 *</view>
    <textarea 
      class="form-input textarea" 
      value="{{reason}}" 
      bindinput="onReasonInput"
      placeholder="请输入加班原因"
      maxlength="500"
    />
  </view>

  <view class="form-group" wx:if="{{showApproverSelector}}">
    <view class="form-label">指定副总审批人（可选）</view>
    <picker 
      mode="selector" 
      range="{{approverOptions}}" 
      range-key="name"
      value="{{approverIndex}}"
      bindchange="onApproverChange"
    >
      <view class="picker">
        <text>{{approverOptions[approverIndex] && approverOptions[approverIndex].name ? approverOptions[approverIndex].name : '默认本人审批'}}</text>
        <text class="picker-icon">▼</text>
      </view>
    </picker>
    <view class="form-hint">默认本人审批，可选择其他副总</view>
  </view>

  <button class="btn btn-primary btn-block" bindtap="submitForm">提交申请</button>
</view>
